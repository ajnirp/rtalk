<% current_user = cookies[:user_name] %>

<h1><%= @room[:title] %></h1>

<!-- Modal -->
<div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
		<h3 id="myModalLabel">Help</h3>
	</div>
	<div class="modal-body">
		<%= render 'layouts/help' %>
	</div>
	<div class="modal-footer">
		<button class="btn btn-primary" data-dismiss="modal" aria-hidden="true">Close</button>
	</div>
</div>

<p>Welcome, <strong><%= current_user %></strong>.</p>

<p>
	<strong>Share the room key with your friends! Click to copy the rooom key to your clipboard:</strong> <%= clippy(@room[:key], bgcolor="CCCCCC").html_safe %>
</p>

	<strong><%= pluralize(@room.get_user_list.length, 'person') %></strong> chatting right now:

<div id="userlist">
	<% @room.get_user_list.each do |usr| %>
		<%= render partial: 'user', locals: { user: usr } %>
	<% end %>
</div>

<div class="row-fluid">
	<ul id="chat">
		<% @room.messages.each do |msg| %>
			<%= render partial: 'message', locals: { message: msg } %>
		<% end %>
	</ul>
</div>

<div class="form-horizontal">
	<%= form_for Message.new, remote: true, id: "new_message" do |f| %>
		<%= f.text_field :content, style: "width:600px", placeholder: "Say something..." %>
		<%= f.hidden_field :room_id, value: @room.id %>
		<%= f.hidden_field :user_name, value: current_user %>
		<%= f.submit "Send", class: "btn btn-info" %>
	<% end %>
</div>

<%= button_to "Leave Room", room_path(@room), method: :delete, class: "btn btn-danger", style: "float:left;margin-right:10px" %>
<%= button_to "Export Chat History", "#", :class => "btn btn-success", style: "float:left;margin-right:10px" %>
<a href="#myModal" class="btn btn-primary" role="button" data-toggle="modal">Help</a>

<%= subscribe_to room_path(@room) %>